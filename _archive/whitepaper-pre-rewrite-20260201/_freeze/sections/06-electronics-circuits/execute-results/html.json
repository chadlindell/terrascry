{
  "hash": "c4b82f03b196f8f71090edbab39b154b",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Electronics and Circuits\"\n---\n\n## Overview {#sec-electronics-overview}\n\nThis section consolidates all circuit designs for the HIRT system, including the MIT (Magneto-Inductive Tomography) circuits, ERT (Electrical Resistivity Tomography) circuits, and base hub electronics. The design uses **centralized electronics with passive probes**: all active components reside in the surface hub, while probes contain only coils and electrodes.\n\nThis architecture offers significant advantages: lower per-probe cost, easier maintenance, better reliability (passive probes are more robust), centralized firmware updates, and simplified probe construction. The trade-off is increased cabling complexity for the multi-probe harness.\n\n::: {.callout-tip}\n## Hardware Documentation Reference\n\nComplete circuit schematics and detailed design notes are maintained in the hardware documentation:\n\n- **MIT Circuit:** `/hardware/schematics/electronics/mit-circuit.md` - Full TX/RX chain design with component values\n- **ERT Circuit:** `/hardware/schematics/electronics/ert-circuit.md` - Howland current source and measurement circuits\n- **Base Hub Circuit:** `/hardware/schematics/electronics/base-hub-circuit.md` - Central hub electronics integration\n- **Block Diagrams:** `/hardware/schematics/electronics/probe-electronics-block.md` - System-level block diagrams\n\nThe diagrams in this section provide conceptual overviews; refer to the hardware schematics for exact component values and PCB layout guidance.\n:::\n\n## System Block Diagram {#sec-system-block}\n\n\n\nThe central hub contains: (1) MCU for control and DSP, (2) MIT transmitter chain (DDS + power driver), (3) MIT receiver chain (preamp + instrumentation amplifier + ADC), (4) ERT current source and voltage measurement, and (5) high-density analog multiplexers. These connect via DB25 trunk cables to passive **Zone Hubs**, which then distribute signals to individual probes.\n\n## MIT Transmit (TX) Chain {#sec-mit-tx}\n\n\n\n## DDS Sine Generator {#sec-dds}\n\nThe transmit chain begins with a Direct Digital Synthesis (DDS) generator, the **AD9833**. This IC provides a highly precise sine wave output from 0.1 Hz to 12.5 MHz with 28-bit frequency resolution. Its compact MSOP-10 footprint and low power consumption make it ideal for the 2-50 kHz HIRT operating range.\n\n| Parameter | Specification |\n|-----------|---------------|\n| Part Number | **AD9833BRMZ** |\n| Frequency Range | 0 Hz to 12.5 MHz |\n| Output Level | 0.6 V p-p sine wave |\n| Interface | SPI (3-wire) |\n| Resolution | 28-bit frequency, 12-bit phase |\n| Power Supply | 2.3-5.5V, 12.65 mW typical |\n\n: AD9833 DDS Generator Specifications. {#tbl-dds-specs}\n\n## TX Power Driver {#sec-tx-driver}\n\nThe DDS output is buffered by a **Texas Instruments OPA2186** precision operational amplifier. This component is selected for its zero-drift architecture and ultra-low quiescent current (**90 µA**), which ensures high precision and extended battery life for the hub while maintaining rail-to-rail output for the TX coil drive.\n\n| Parameter | OPA2186 Specification |\n|-----------|------------------|\n| Quiescent Current | **90 µA** |\n| Drift | **0.04 µV/°C** (Zero-Drift) |\n| Offset Voltage | 10 µV |\n| Power Supply | 4.5V to 36V |\n\n: TX Driver Op-Amp Specifications. {#tbl-tx-driver}\n\n## MIT Receive (RX) Chain {#sec-mit-rx}\n\n\n\n## RX Preamplifier (AD8421) {#sec-rx-preamp}\n\nThe receiver front-end utilizes the **Analog Devices AD8421**. This high-speed instrumentation amplifier features an exceptionally low input voltage noise floor of **3 nV/$\\sqrt{\\mathrm{Hz}}$**. This performance characteristic is essential for resolving the weak secondary magnetic fields generated by subsurface targets in the MIT tomography process.\n\n| Parameter | Specification |\n|-----------|---------------|\n| Component | **AD8421** |\n| Input Noise | **3 nV/$\\sqrt{\\mathrm{Hz}}$** |\n| Bandwidth (G=10) | 10 MHz |\n| Slew Rate | 35 V/µs |\n| Supply Current | 2.0 mA |\n\n: RX Preamplifier Specifications. {#tbl-preamp-specs}\n\n### Noise Floor Measurement Conditions {#sec-noise-conditions}\n\nThe AD8421's specified noise floor of **3 nV/$\\sqrt{\\mathrm{Hz}}$** is achieved under specific measurement conditions. Field performance depends on several factors:\n\n| Condition | Specification | Field Typical | Impact on SNR |\n|-----------|---------------|---------------|---------------|\n| Bandwidth | 1-50 kHz (HIRT operating range) | 2-50 kHz | ~100 nV RMS integrated |\n| Temperature | 25°C reference | -10 to +40°C | ±10% variation |\n| Cable length | <1 m bench test | 3-5 m probe cable | +20-50% noise pickup |\n| Averaging | 100-sample mean | 16-64 samples typical | Improves by $\\sqrt{N}$ |\n\n: Noise floor measurement conditions and field impact. {#tbl-noise-conditions}\n\n**Integrated Noise Calculation:** For a 1-50 kHz bandwidth (49 kHz span), the theoretical integrated input-referred noise is:\n\n$$V_{n,rms} = 3\\ \\text{nV}/\\sqrt{\\text{Hz}} \\times \\sqrt{49,000\\ \\text{Hz}} \\approx 100\\ \\text{nV RMS}$$\n\nThis represents the *design target* under controlled conditions. Field measurements typically show 150-300 nV RMS due to cable capacitance, EMI pickup, and connector losses.\n\n::: {.callout-note}\n## Performance Claim Context\n\nThe ~100 nV noise floor is a **design target** based on component specifications and bench measurements. Actual field performance varies with environmental conditions and cable routing. For planning purposes, assume 200-300 nV RMS input-referred noise in typical outdoor conditions.\n:::\n\n## Signal Conditioning and Gain Stage {#sec-signal-conditioning}\n\nFollowing the AD8421 preamplifier, the signal passes through additional gain and filtering stages before reaching the ADC. An instrumentation amplifier (INA128) provides adjustable gain to match signal levels to the ADC input range. The total signal chain gain is typically 800-1000x, bringing microvolt-level coil signals up to the millivolt range required by the ADC.\n\n## Signal Level Progression {#sec-signal-levels}\n\n\n\n## Lock-In Detection {#sec-lockin}\n\nLock-in detection is essential for extracting weak MIT signals from noise. The HIRT system uses **digital lock-in detection** implemented in the MCU, which offers flexibility, software configurability, and no analog drift. The technique multiplies the received signal by reference sine and cosine waveforms at the excitation frequency, then low-pass filters to extract the in-phase (I) and quadrature (Q) components.\n\n\n\nThe lock-in algorithm provides exceptional noise rejection (> 40 dB improvement) by responding only to signals at the exact reference frequency. This allows detection of MIT signals buried deep in noise, critical for weak responses from distant or low-conductivity targets.\n\n## Digital Lock-In Algorithm {#sec-lockin-algorithm}\n\n```c\n// Simplified digital lock-in implementation\nfloat I_sum = 0, Q_sum = 0;\nfor (int i = 0; i < N_samples; i++) {\n    float sample = read_adc();\n    float ref_I = sin(2 * PI * f * i / Fs);\n    float ref_Q = cos(2 * PI * f * i / Fs);\n    I_sum += sample * ref_I;\n    Q_sum += sample * ref_Q;\n}\nfloat amplitude = sqrt(I_sum*I_sum + Q_sum*Q_sum) / N_samples;\nfloat phase = atan2(Q_sum, I_sum);\n```\n\n## ERT Current Source (Howland Pump) {#sec-ert-current}\n\nThe ERT subsystem injects controlled current into the ground through electrode rings and measures the resulting voltage distribution. The current source uses a **Howland current pump** topology, which provides high output impedance (>1 M-ohm) and stable current regardless of load variations.\n\n\n\n| Parameter | Specification |\n|-----------|---------------|\n| Output Current | 0.5-2 mA (adjustable) |\n| Current Accuracy | +/- 5% |\n| Compliance Voltage | +/- 10V minimum |\n| Output Impedance | > 1 M-ohm |\n| Load Range | 100 ohm - 10 k-ohm |\n| Polarity Reversal | Programmable (0.5 Hz) |\n\n: ERT Current Source Specifications. {#tbl-ert-current}\n\n### Compliance Voltage vs Load {#sec-ert-compliance}\n\nThe +/-10V compliance voltage determines the maximum load impedance at each current setting. Operators should select current levels based on expected soil resistivity to ensure adequate measurement headroom:\n\n| Max Current | Max Load at 10V | Typical Application |\n|-------------|-----------------|---------------------|\n| 2.0 mA | 5 k-ohm | Low resistivity soil (<100 ohm-m) |\n| 1.0 mA | 10 k-ohm | Medium resistivity (100-500 ohm-m) |\n| 0.5 mA | 20 k-ohm | High resistivity (>500 ohm-m) |\n\n: ERT current vs load compliance limits. Higher resistivity soils require lower current to stay within compliance voltage. {#tbl-ert-compliance}\n\n::: {.callout-warning}\n## Compliance Limit Warning\n\nIf the load impedance exceeds the compliance limit for the selected current, the current source will saturate and actual injected current will be less than commanded. The ERT firmware monitors this condition and flags affected measurements. Reduce current setting or improve electrode contact if compliance warnings occur frequently.\n:::\n\n## Polarity Reversal {#sec-polarity-reversal}\n\nElectrode polarization causes measurement drift in DC systems. To mitigate this, HIRT reverses the current polarity every 2 seconds using a DPDT relay (G5V-2-H1) or solid-state switch (ADG1219). Positive and negative measurements are averaged to cancel polarization effects.\n\n\n\n## ADC Interface {#sec-adc}\n\n\n\n| Parameter | ADS1256 Specification |\n|-----------|----------------------|\n| Resolution | 24 bits |\n| Sample Rate | 30 kSPS maximum |\n| Noise | 0.6 uV RMS (at 100 SPS) |\n| Interface | SPI |\n| Internal PGA | 1, 2, 4, 8, 16, 32, 64x |\n| Input Channels | 8 single-ended or 4 differential |\n\n: ADS1256 ADC Specifications. {#tbl-adc-specs}\n\n## Multiplexer Switching {#sec-multiplexer}\n\nWith up to 24 probes in a typical array, the HIRT system requires a scalable multiplexing strategy. The design uses **CD74HC4067** 16:1 analog multiplexers controlled by MCU GPIO pins. Each TX and RX signal path has its own multiplexer, allowing independent selection of transmit and receive probes. For arrays exceeding 16 probes, cascaded multiplexers can be used.\n\n\n\n## Power Distribution {#sec-power}\n\n\n\n| Rail | Voltage | Current | Purpose |\n|------|---------|---------|---------|\n| +12V (Battery) | 11.1-12.6V | 200 mA total | System input |\n| +5V (LDO) | 5.0V | 50 mA | Power driver, references |\n| +3.3V (LDO) | 3.3V | 100 mA | MCU, ADC, digital |\n| -5V (Charge pump) | -5.0V | 10 mA | Op-amp negative rail |\n\n: Power Rail Specifications. {#tbl-power-rails}\n\n## Noise Filtering Stages {#sec-noise-filtering}\n\n\n\nNoise reduction is critical for MIT measurements where signal levels can be in the microvolt range. The filtering strategy employs multiple stages:\n\n- **Input RC filter (fc=100kHz):** Blocks RF interference and high-frequency EMI\n- **High-pass filter (fc=100Hz):** Removes DC offsets and 60Hz pickup\n- **Active band-pass (1-50kHz):** Passes only the measurement band\n- **Anti-aliasing filter (fc=15kHz):** Prevents aliasing in ADC sampling\n- **Digital matched filter:** Optimizes SNR in post-processing\n\n## Shielding and Ground Loop Prevention {#sec-grounding}\n\n\n\nProper grounding is essential for achieving low-noise measurements. The HIRT design follows these best practices:\n\n- **Star grounding:** All ground returns connect at a single point near the ADC\n- **Separate ground planes:** Analog and digital grounds are split on the PCB\n- **Shielded cables:** All signal cables use twisted-pair with overall shield\n- **Single-point shield termination:** Shields grounded at hub end only\n- **Minimum loop area:** Signal and return paths routed together\n\n## PCB Layout Guidelines {#sec-pcb-layout}\n\n\n\n## Layout Rules {#sec-layout-rules}\n\n1. Place bypass capacitors (100nF) within 5mm of each IC power pin\n2. Route analog signals with minimum trace length; avoid crossing digital signals\n3. Use differential pairs for RX coil signals with matched length\n4. Keep TX and RX signal paths physically separated (>10mm)\n5. Provide shielding (copper pour) around sensitive analog circuits\n6. Use wide traces (>20 mil) for power distribution\n7. Connect analog and digital ground planes at a single star point near the ADC\n\n## Key Component Summary {#sec-components}\n\n| Component | Part Number | Function | Package |\n|-----------|-------------|----------|---------|\n| DDS | AD9833BRMZ | Signal generator | MSOP-10 |\n| TX Driver | OPA454AIDDAR | Coil driver | SOIC-8 |\n| Preamp | AD8421BRZ | RX preamplifier | SOIC-8 |\n| Inst Amp | INA128PAG4 | Gain stage | DIP-8 |\n| ADC | ADS1256IDBR | 24-bit ADC | SSOP-28 |\n| Multiplexer | CD74HC4067M | 16-channel mux | SOIC-24 |\n| MCU | ESP32-WROOM-32 | Controller | Module |\n| V-Reference | REF5025AIDGKR | 2.5V reference | SOIC-8 |\n| LDO | AMS1117-3.3 | 3.3V regulator | SOT-223 |\n\n: Key IC Components. {#tbl-components}\n\n## Connector Pinouts (Probe-to-Zone) {#sec-pinouts}\n\n| Pin | Signal | Description |\n|-----|--------|-------------|\n| 1 | TX+ | To probe TX coil |\n| 2 | TX- | Return path |\n| 3 | RX+ | Differential RX |\n| 4 | RX- | Differential RX return |\n| 5 | Guard | Analog ground |\n| 6 | Ring A | Upper ERT electrode |\n| 7 | Ring B | Mid ERT electrode |\n| 8 | Ring C | Deep electrode |\n| 9 | ID Sense | Auto-ID resistor |\n| 10-11 | Spare | Reserved |\n| 12 | Shield | Cable shield clamp |\n\n: 12-pin Probe Connector Pinout. {#tbl-pinout}\n\n## Firmware Status {#sec-firmware-status}\n\n::: {.callout-note}\n## Firmware Development - Phase 2\n\nThe hardware system documented in this whitepaper requires MCU firmware to operate. Firmware development is explicitly **Phase 2** of the project, separate from the hardware design presented here.\n\n**Current Status:**\n\n- Hardware is designed for ESP32-WROOM-32 MCU\n- No firmware repository is published yet\n- Planned firmware features: DDS control, ADC sampling, lock-in detection, USB data logging\n\n**Planned Repository:** `github.com/hirt-project/hirt-firmware` (future)\n\nBuilders can test hardware subsystems (coils, ERT source, ADC) using bench equipment before firmware is available. See Section 18 for the software development roadmap.\n:::\n\n## Safety Considerations {#sec-safety}\n\n::: {.callout-warning}\n## ELECTRICAL SAFETY\n\n- Maximum output current limited to 5 mA by design\n- Compliance voltage restricted to +/-12V (safe for soil contact)\n- Include 10 mA fast-blow fuse on ERT output\n- Use opto-isolated relay control for polarity switching\n- Ensure proper earth ground connection for safety\n:::\n\n## Troubleshooting Guide {#sec-elec-troubleshooting}\n\n| Symptom | Likely Cause | Solution |\n|---------|--------------|----------|\n| No TX output | DDS not initialized | Check SPI connection, verify clock |\n| Weak RX signal | Gain too low | Verify R~G~ resistor, check amplifier rails |\n| Noisy readings | Ground loops | Implement star grounding, shield cables |\n| No ERT current | Open circuit | Check electrode contact, verify relay state |\n| Current drift | Reference unstable | Verify Vref output, add bypass caps |\n| ADC errors | SPI timing | Reduce SPI clock speed, check DRDY timing |\n\n: Common Issues and Solutions. {#tbl-troubleshooting}\n\n## References {#sec-electronics-references}\n\n1. Analog Devices. AD9833 Programmable Waveform Generator Data Sheet. Rev. F, 2019. [Datasheet](https://www.analog.com/media/en/technical-documentation/data-sheets/AD9833.pdf)\n\n2. Texas Instruments. OPA454 High-Voltage, High-Current Operational Amplifier. SBOS328D, 2018. [Datasheet](https://www.ti.com/lit/ds/symlink/opa454.pdf)\n\n3. Analog Devices. AD620 Low Cost, Low Power Instrumentation Amplifier. Rev. H, 2011. [Datasheet](https://www.analog.com/media/en/technical-documentation/data-sheets/AD620.pdf)\n\n4. Texas Instruments. INA128 Precision, Low Power Instrumentation Amplifiers. SBOS051B, 2005. [Datasheet](https://www.ti.com/lit/ds/symlink/ina128.pdf)\n\n5. Texas Instruments. ADS1256 Very Low Noise, 24-Bit Analog-to-Digital Converter. SBAS288K, 2013. [Datasheet](https://www.ti.com/lit/ds/symlink/ads1256.pdf)\n\n6. Horowitz, P. and Hill, W. (2015). *The Art of Electronics*, 3rd Edition. Cambridge University Press. Chapter 5: Precision Circuits. [DOI: 10.1017/CBO9781139644204](https://doi.org/10.1017/CBO9781139644204)\n\n7. Ott, H.W. (2009). *Electromagnetic Compatibility Engineering*. Wiley. Chapter 3: Grounding. [DOI: 10.1002/9780470508510](https://doi.org/10.1002/9780470508510)\n\n",
    "supporting": [
      "06-electronics-circuits_files/figure-html"
    ],
    "filters": [],
    "includes": {}
  }
}