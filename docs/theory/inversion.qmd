---
title: "Inversion and Reconstruction"
---

## Overview

This section covers the mathematical foundations and algorithms for tomographic reconstruction from HIRT measurements. For practical interpretation guidance, see [Field Guide: Interpretation](../field-guide/interpretation.qmd).

Tomographic inversion solves the "inverse problem": finding the subsurface property distribution that best explains the measured data.

## Data Processing Pipeline

HIRT data processing follows a systematic pipeline from raw field acquisition through final interpretation:

1. **Data Acquisition:** Raw ADC samples collected from probe pairs
2. **Filter and Average:** Noise reduction through digital filtering and stacking
3. **Background Removal:** Subtract homogeneous response to isolate anomalies
4. **Reciprocity Check:** Validate A-to-B equals B-to-A for quality assurance
5. **Tomographic Inversion:** Reconstruct 3D conductivity/resistivity distribution
6. **MIT/ERT Fusion:** Combine multi-modal data for comprehensive interpretation
7. **3D Model Generation:** Build voxel grid from inverted data
8. **Visualization:** Generate depth slices, isosurfaces, and reports

## Mathematical Basis of Reconstruction

### Forward Models

**MIT (Quasi-Static Maxwell's Equations):** The secondary magnetic field B_s generated by eddy currents in a conductive medium is governed by:

$$\nabla \times \mathbf{E} = -i \omega \mathbf{B}$$

$$\nabla \times \mathbf{H} = \sigma \mathbf{E} + \mathbf{J}_s$$

Where $\sigma$ is conductivity, $\omega$ is angular frequency, and $\mathbf{J}_s$ is the source current.

**ERT (Poisson's Equation):** The electric potential $\phi$ distribution due to a current source $I$ in a medium of conductivity $\sigma$ is governed by:

$$\nabla \cdot (\sigma \nabla \phi) = -I \delta(\mathbf{r} - \mathbf{r}_s)$$

### Inverse Problem Formulation

The reconstruction minimizes an objective function $\Phi$ comprising data mismatch and model roughness (regularization):

$$\Phi(\mathbf{m}) = \| \mathbf{d}_{obs} - F(\mathbf{m}) \|^2 + \lambda \| \mathbf{R} \mathbf{m} \|^2$$

Where $\mathbf{d}_{obs}$ is observed data, $F(\mathbf{m})$ is the forward model output for model $\mathbf{m}$, $\mathbf{R}$ is the roughness matrix, and $\lambda$ is the regularization parameter.

This is typically solved using a Gauss-Newton iterative update:

$$\mathbf{m}_{k+1} = \mathbf{m}_k - (\mathbf{J}^T \mathbf{J} + \lambda \mathbf{R}^T \mathbf{R})^{-1} \mathbf{J}^T (\mathbf{d}_{obs} - F(\mathbf{m}_k))$$

Where $\mathbf{J}$ is the Sensitivity Matrix (Jacobian) describing how data changes with model parameters.

## Inversion Best Practices

Based on established practices in SimPEG and pyGIMLi, the following guidelines optimize inversion results for HIRT data.

### Regularization Parameters

For crosshole/borehole geometries, anisotropic regularization improves results:

| Parameter | Surface Survey | Crosshole Survey | Notes |
|-----------|---------------|------------------|-------|
| zWeight | 1.0 | 0.3-0.5 **(Modeled)** | Reduced vertical smoothing for crosshole |
| Lateral smoothing | Standard | Standard | Maintain lateral continuity |
| Alpha_s (smallness) | 0.001-0.01 **(Modeled)** | 0.001-0.01 **(Modeled)** | Model norm regularization |
| Alpha_x/y/z (smoothness) | 1.0 | 1.0/1.0/0.3 **(Modeled)** | Directional smoothness weights |

: Recommended regularization parameters (from SimPEG/pyGIMLi best practices) {#tbl-regularization}

The reduced zWeight (0.3-0.5) **(Modeled)** for crosshole surveys allows sharper vertical boundaries—appropriate when horizontal ray paths provide good vertical resolution.

### Starting Model Selection

The starting model significantly affects inversion convergence and final results:

- **Default starting model**: Use background resistivity estimate, typically ln(100 ohm·m) = ln(0.01 S/m) **(Modeled)**
- **Site-specific**: If prior information exists, use that as the starting model
- **Homogeneous half-space**: Appropriate when no prior information is available

::: {.callout-note}
## SimPEG Convention
SimPEG uses log-conductivity (ln σ) parameterization. A starting model of ln(0.01) corresponds to 100 ohm·m **(Modeled)** resistivity. This ensures positivity and improves numerical stability.
:::

### Mesh Design Guidelines

| Element | Guideline | Rationale |
|---------|-----------|-----------|
| Cell size at electrodes | ~10% of electrode spacing **(Modeled)** | Resolves current injection |
| Cell size in target zone | ~25% of expected feature size **(Modeled)** | Adequate resolution |
| Padding cells | 3-5 layers, expanding **(Modeled)** | Boundary condition stability |
| Mesh type (ERT) | Tetrahedral or OcTree | Handles topography and refinement |

: Mesh design guidelines (from finite element best practices) {#tbl-mesh-guidelines}

For HIRT's ~0.5 m ring electrode spacing, cells near electrodes should be ~5 cm **(Modeled)**. For the target zone between probes, 10-25 cm cells **(Modeled)** typically provide adequate resolution.

## Data Uncertainty and Error Propagation

### Sources of Measurement Error

| Error Source | MIT Typical | ERT Typical | Mitigation |
|--------------|-------------|-------------|------------|
| Instrument noise | 2-5% **(Target)** | 1-3% **(Target)** | Averaging, filtering |
| Electrode contact | N/A | 2-10% **(Modeled)** | Contact resistance check |
| Position uncertainty | 1-3% **(Modeled)** | 1-3% **(Modeled)** | Careful surveying |
| Temperature drift | 1-2% **(Modeled)** | 1-2% **(Modeled)** | Reference measurements |
| Reciprocity error | 2-5% **(Target)** | 2-5% **(Target)** | QC during acquisition |
| **Combined (RSS)** | **3-8% (Target)** | **3-12% (Target)** | All above measures |

: Typical measurement error sources {#tbl-error-sources}

### Assigning Data Weights

Data weights $w_i$ in the inversion are typically set as the inverse of estimated standard deviation:

$$w_i = \frac{1}{\sigma_i} = \frac{1}{\epsilon_r \cdot |d_i|}$$

Where $\epsilon_r$ is the relative error (typically 3-5% **(Target)** for HIRT) and $d_i$ is the measured datum.

### Model Resolution and Covariance

The relationship between data uncertainty and model uncertainty is governed by the model resolution matrix:

$$\mathbf{R} = (\mathbf{J}^T \mathbf{W} \mathbf{J} + \lambda \mathbf{R}_m^T \mathbf{R}_m)^{-1} \mathbf{J}^T \mathbf{W} \mathbf{J}$$

The diagonal elements indicate how well each model parameter is resolved by the data.

The model parameter covariance matrix is:

$$\mathbf{C}_m = (\mathbf{J}^T \mathbf{W} \mathbf{J} + \lambda \mathbf{R}_m^T \mathbf{R}_m)^{-1} \sigma_d^2$$

### Practical Uncertainty Assessment

**Step 1: Assign Data Weights**

- Start with uniform 5% **(Target)** relative error assumption
- Increase weights for measurements with poor reciprocity (>5%)
- Decrease weights for repeated measurements that show consistency

**Step 2: Run Multiple Inversions (Ensemble Approach)**

1. Add Gaussian noise to measured data: $d_i^{(k)} = d_i + N(0, \sigma_i)$
2. Invert each perturbed dataset independently
3. Compute mean and standard deviation across ensemble

Minimum recommended: 20 realizations **(Modeled)**; robust estimate: 50-100 realizations **(Modeled)**.

**Step 3: Calculate DOI Index**

The Depth of Investigation (DOI) index identifies regions where inversion results are constrained by data vs. dominated by regularization:

1. Run inversion with two different reference models (e.g., 10× and 0.1× background)
2. DOI = (m_1 - m_2) / (m_ref1 - m_ref2)
3. DOI < 0.1 **(Modeled)**: Well-constrained by data
4. DOI > 0.3 **(Modeled)**: Poorly constrained, regularization-dominated

**Step 4: Report Uncertainty with Results**

- Estimated parameter uncertainty (from ensemble or covariance analysis)
- DOI map showing sensitivity coverage
- Confidence level assignment:
  - HIGH: Feature in >90% of realizations, DOI < 0.1 **(Modeled)**
  - MEDIUM: Feature in 70-90% of realizations, DOI < 0.2 **(Modeled)**
  - LOW: Feature in 50-70% of realizations, or DOI > 0.2 **(Modeled)**

::: {.callout-important}
## Reporting Uncertainty is Mandatory

Tomographic images without uncertainty estimates can be misleading. A sharp-looking anomaly in a region with poor sensitivity (high DOI) may be an artifact. Always report uncertainty alongside interpretation.
:::

## Irregular Array Handling

### Key Principle: Inversion Uses Actual Positions

Modern inversion algorithms (SimPEG, pyGIMLi, EIDORS) construct the sensitivity matrix from **actual electrode positions**, not idealized grid coordinates:

- A probe offset by 30 cm **(Modeled)** is correctly incorporated if its position is accurately recorded
- Irregular spacing does not inherently degrade inversion quality
- **Accurate position documentation** is more important than perfect grid geometry

### Impact of Array Irregularities

| Condition | Impact on Coverage | Impact on Resolution | Mitigation |
|-----------|-------------------|---------------------|------------|
| Probe offset <0.5 m **(Modeled)** | Minimal | Negligible | Record actual position |
| Probe offset 0.5-1.0 m **(Modeled)** | Minor asymmetry | Slight reduction | Document reason |
| Missing probe | Reduced ray coverage | Lower resolution in gap | Report reduced confidence |
| Partial depth (>50%) | Upper sensors valid | Normal for shallow | Exclude below-tip sensors |
| Partial depth (<50%) | Limited value | Significantly reduced | Consider omitting |
| Surface topography >0.5 m **(Modeled)** | Requires mesh adjustment | Minor if accounted for | Use actual Z coordinates |

: Impact of array irregularities (from sensitivity analysis) {#tbl-irregularity-impact}

### Handling Missing Probes

**Coverage Effects:**
- Ray paths through gap have reduced density
- Anomalies within gap may be under-resolved
- Edge effects extend ~1 spacing distance **(Modeled)** into covered area

**Mitigation Strategies:**
1. Add extra probes on opposite side of gap if possible
2. Extend adjacent survey sections for overlap
3. Supplement with surface methods (GPR, magnetometry) over gap

### Partial-Depth Probe Processing

1. **Record actual tip depth** in survey geometry file
2. **Identify valid sensors:** Only electrodes above tip contribute
3. **Configure inversion:** Exclude positions below z_tip
4. **Adjust sensitivity weights:** Partial probe provides reduced coverage

## Resolution Limits

### Lateral Resolution

Lateral resolution depends on probe spacing and measurement density. HIRT can resolve features with dimensions approximately 0.5 to 1.5 times **(Modeled)** the probe spacing.

| Probe Spacing | Minimum Feature (Modeled) | Practical Resolution (Modeled) |
|---------------|-----------------|---------------------|
| 1.0 m | 0.5 m | 0.75-1.0 m |
| 1.5 m | 0.75 m | 1.0-1.5 m |
| 2.0 m | 1.0 m | 1.5-2.0 m |

: Lateral resolution limits {#tbl-lateral-resolution}

### Depth Resolution

**MIT Depth Resolution:** Controlled by frequency. Approximately:

$$\Delta z_{MIT} \approx 0.5 \sqrt{\frac{2}{\omega \mu_0 \sigma}}$$

For 5 kHz in 10 mS/m soil, this yields approximately 0.5-0.8 m **(Modeled)** vertical resolution.

**ERT Depth Resolution:** Depends on electrode spacing. With 0.5 m vertical spacing, features separated by less than 0.25-0.5 m **(Modeled)** vertically will blur.

### Resolution Degradation with Depth

Below the probe tips, sensitivity falls approximately exponentially:

- **0-0.5 m below tip:** Resolution degrades by ~30% **(Modeled)**
- **0.5-1.0 m below tip:** Resolution degrades by ~60% **(Modeled)**
- **>1.0 m below tip:** Detection unreliable **(Modeled)**

::: {.callout-warning}
## Do Not Extend Inversions Beyond Probe Depth

While mathematically possible, results below the probe tips are highly uncertain and often artifacts. Report survey depth as probe insertion depth, not inversion mesh extent.
:::

## The Non-Uniqueness Problem

Geophysical inversion suffers from a fundamental limitation: multiple different subsurface models can produce nearly identical measured data.

### Why Results Are "Most Likely" Not "Certain"

The inverse problem is underdetermined. The number of model parameters (thousands of mesh cells) greatly exceeds the number of independent measurements (hundreds of probe pairs). Regularization forces preference for smooth models, introducing bias.

**Practical Implication:** A tomogram showing a high-conductivity anomaly at 2.5 m **(Modeled)** depth could represent:

- A single large metallic object
- Multiple smaller objects distributed over depth
- A conductive soil layer combined with smaller metal
- Any combination producing the same integrated response

### Mitigating Non-Uniqueness

- **Site history:** Expected target types constrain interpretation
- **Geological context:** Soil type informs background model
- **Multi-modal fusion:** MIT and ERT together reduce ambiguity
- **Depth constraints:** Targets below probe depth are highly uncertain

## MIT+ERT Data Fusion

### Fusion Approaches

**1. Sequential Interpretation (Recommended)**

1. Invert MIT data --> conductivity tomogram
2. Invert ERT data --> resistivity tomogram
3. Identify anomalies independently
4. Cross-reference anomaly locations
5. Classify based on combined signature

**2. Joint Inversion (Advanced)**

- Simultaneous inversion with structural coupling
- Shared mesh encourages consistent boundaries
- Requires careful data weighting

**3. Probability Fusion (Decision Support)**

1. Generate probability maps for each modality
2. Combine using Bayesian framework
3. Output: unified probability map for prioritization

### Fusion Artifacts

**Registration Errors:** Verify grid alignment before fusion.

**Resolution Mismatch:** A small metal object may appear tight in MIT but smeared in ERT.

**Depth Discrepancy:** Same target may appear at slightly different depths. Allow ±0.5 m **(Modeled)** tolerance.

## Software Compatibility

HIRT data can be processed with standard open-source inversion frameworks:

- **SimPEG (Python):** MIT and ERT inversion with flexible mesh handling
- **pyGIMLi (Python):** Excellent crosshole ERT support, joint inversion
- **EIDORS (Matlab/Octave):** MIT reconstruction, biomedical heritage
- **ResIPy (Python):** User-friendly ERT inversion wrapper
- **bh_tomo (MATLAB, GNU license):** Specifically designed for borehole/crosshole tomography. Provides ray-path computation (straight and curved), crosshole geometry handling, and constrained inversion with anisotropy support. Directly applicable to HIRT's crosshole ERT channel. [GitHub](https://github.com/groupeLIAMG/bh_tomo)

### Crosshole-Specific Software

For HIRT's crosshole geometry, **bh_tomo** from the LIAMG group (Ecole Polytechnique de Montreal) deserves special mention. Unlike general-purpose inversion packages that were designed primarily for surface arrays, bh_tomo was built from the ground up for borehole/crosshole tomography. Key features relevant to HIRT:

- **Ray-path computation:** Handles both straight-ray and curved-ray (refraction) geometries
- **Crosshole geometry:** Native support for the source-receiver configurations used in crosshole surveys
- **Tomographic inversion:** SIRT, LSQR, and constrained inversion methods
- **Anisotropy support:** Can model directional property variations
- **Data types:** Supports both traveltime (seismic/radar) and amplitude datasets

While bh_tomo was originally developed for georadar and seismic crosshole tomography, its algorithms for handling crosshole geometry and ray-based inversion are directly transferable to ERT data processing.

See [Developer: Data Formats](../developer/data-formats.qmd) for file format specifications.
